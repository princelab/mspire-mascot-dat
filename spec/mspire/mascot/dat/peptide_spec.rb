require 'spec_helper'

require 'mspire/mascot/dat'
require 'mspire/mascot/dat/peptide'

describe 'reading off the peptides' do

  before(:each) do
    file = TESTFILES + '/F004129.dat'
    @io = File.open(file)
    @io.pos = 62743
  end

  after(:each) do
    @io.close
  end

  it 'has an iterator' do
    info = Mspire::Mascot::Dat::Peptide.each(@io).map do |pep|
      [pep.ions_score, pep.query_num, pep.peptide_num]
    end
    info.should == [[0.22, 1, 1], [4.11, 2, 1], [2.84, 2, 2], [2.83, 2, 3], [2.65, 2, 4], [2.28, 2, 5], [1.07, 2, 6], [0.99, 2, 7], [0.96, 2, 8], [0.65, 2, 9], [0.63, 2, 10]]
  end

end

=begin
q1_p1=0,2113.999008,-0.998912,4,VMLSDADPSLEQYYVNVR,17,00100000000000000000,0.22,0002002000000000000,0,0;"Q23985":0:79:96:1
q1_p1_terms=R,T
q1_p1_primary_nl=00100000000000000000
q2_p1=0,2978.269196,1.195840,5,MDSSSGSQGNGSFMDQNSLGILNMDNLK,17,000000000000001000000000100000,4.11,0002000020000000000,0,0;"Q9VV79":0:1:28:1
q2_p1_terms=-,V
q2_p1_primary_nl=000000000000002000000000200000
q2_p2=1,2979.449478,0.015558,5,STGAESSEEXLREAYIMASVEHVNLLK,45,00000000000000000100000000000,2.84,0000000020000000000,0,0;"Q6SAG3":0:875:901:1
q2_p2_terms=K,L
q2_p2_primary_nl=00000000000000000200000000000
q2_p2_subst=10,X,T
q2_p3=1,2980.525406,-1.060370,5,LSSPPSTSHTYEGKLLTKPTHTNTDLR,45,00000000000000000000000000000,2.83,0000000020000000000,0,0;"Q6KEU5":0:82:108:1,"Q6KEU6":0:82:108:1
q2_p3_terms=K,G:K,G
q2_p4=0,2978.269196,1.195840,4,MDSSSGSQGNGSFMDQNSLGILNMDNLK,31,010000000000000000000000100000,2.65,0000000020000000000,0,0;"Q9VV79":0:1:28:1
q2_p4_terms=-,V
q2_p4_primary_nl=020000000000000000000000200000
q2_p5=1,2980.380035,-0.914999,4,FGDMFSKESEQVALAVYEAYDPNVGSK,17,00000000000000000000000000000,2.28,0000002020000000000,0,0;"P82982":0:340:366:1
q2_p5_terms=K,S
q2_p6=0,2978.688492,0.776544,8,GAEFSSFSVVLLVIILIIVFLSNAYHK,118,00000000000000000000000000000,1.07,0000020000000000000,0,0;"A8DYF1":0:2:28:1
q2_p6_terms=M,A
q2_p7=1,2979.588989,-0.123953,4,KLQSNATVLSDGYAAHLAGLQAVGGSRPAK,45,00000000000000000000000000000000,0.99,0000020010000000000,0,0;"P43125":0:1187:1216:1,"P43125-2":0:1187:1216:1,"D2NUF3":0:172:201:1
q2_p7_terms=K,G:K,G:K,G
q2_p8=0,2980.229141,-0.764105,3,LMFGDEEGNLPSLDQEDEQVPETEED,31,0010000000000000000000000000,0.96,0002000000000000000,0,0;"Q9VVZ8":0:703:728:1
q2_p8_terms=R,-
q2_p8_primary_nl=0020000000000000000000000000
q2_p9=1,2978.364624,1.100412,2,LCPRCFQELSDYDTIMVNLMTTQK,17,00000000000000000000100000,0.65,0000002000000000000,0,0;"P07664":0:60:83:1
q2_p9_terms=R,R
q2_p9_primary_nl=00000000000000000000100000
q2_p10=0,2978.672592,0.792444,5,NGSSVAGTSVLSPSIPLTLVVLPALMIAQK,70,00000000000000000000000000100000,0.63,0000000020000000000,0,0;"B8A406":0:72:101:1,"C6SUW4":0:177:206:1,"A1Z9D9":0:246:275:1
q2_p10_terms=K,S:K,S:K,S
q2_p10_primary_nl=00000000000000000000000000100000
=end

